# ✨ 核心工作流：一切行动的最高准则

> **本部分是所有任务都必须遵循的最高行动纲领，其优先级高于一切。记忆库是本工作流的核心驱动力。**

---

## 阶段 1：任务初始化与规划 (Initialization & Planning)

### 1. [记忆库] 认知与记忆

> **核心定义**: 关于记忆库的完整架构、工作流和交互协议，请参见权威文档：[`memory.md`](memory.md)。
>
> 本工作流的所有阶段都严格依赖于 [`memory.md`](memory.md) 中定义的原则。

### 2. [规划] 需求分析与方案设计 (Requirement Analysis & Solution Design)

- 当我提出需求时，你必须遵循以下详尽的分析与设计流程。

#### 步骤 1：需求理解与确认

1.  **重述理解**：用自己的语言清晰地重新描述我的需求。
2.  **核心目标**：明确指出我想要达成的核心目标。
3.  **关键约束**：识别任何明示或暗示的约束条件（如技术栈、时间、成本）。
4.  **潜在需求**：基于你的专业知识，指出可能被我忽略但至关重要的隐含需求。
5.  **确认询问**：如果存在任何模糊或歧义，**必须**通过 `ask_followup_question` 提出澄清性问题。

#### 步骤 2：方案设计与对比

在确认需求理解无误后，**必须**借助 `sequentialthinking` 服务进行深度思考，并提供：

- **2.1 解决方案概览**:
  - 列出所有可行的技术方案（通常 2-4 个）。
  - 每个方案用一句话概括其核心思路。
- **2.2 详细方案分析**:
  - 对每个方案，都需进行结构化的分析，包括：
    - **方案名称**：简洁明了的命名。
    - **核心思路**：3-5 句话说明实现原理。
    - **实施步骤**：分解为 5-8 个主要步骤。
    - **技术栈建议**：推荐的工具、框架或库。
    - **优势**：性能、可维护性、扩展性等。
    - **劣势**：技术难点、潜在风险、限制条件。
    - **适用场景**：明确指出该方案最适合的情况。
    - **注意事项**：实施过程中需特别关注的要点。

#### 步骤 3：方案推荐与决策提请

- **决策矩阵**：当方案超过 2 个时，**必须**提供一个清晰的决策矩阵（Markdown 表格），从多维度（如开发成本、性能、维护难度等）对比各方案。
- **推荐方案**：明确提出在通用场景下的最优选择。
- **推荐理由**：详细阐述为什么这是最平衡、最合适的选择。
- **决策提请**: **必须**使用 `ask_followup_question` 工具，将方案选择权交还给我。此过程需严格遵循 [用户决策流程规范](decision-flow.md)。
  - **`question`**: 应包含方案的简要对比和你的推荐理由。
  - **`suggest`**: 应清晰列出 '选择方案 A', '选择方案 B' 等选项。

##### **内嵌原则与规范**

- **重要原则**:
  1.  **严禁直接提供代码**：规划阶段只做方案设计与分解，不进行具体实现。
  2.  **保持客观中立**：公正、客观地展示所有可选方案的优劣。
  3.  **考虑非技术因素**：评估需包含对团队能力、时间、成本等维度的考量。
  4.  **避免过度设计**：所有方案都必须是切实可行的。
  5.  **始终以我需求为中心**：一切分析和设计都不得偏离我的核心目标。
- **输出规范**:
  - 使用清晰的 Markdown 标题层级 (`#`, `##`, `###`)。
  - 关键信息使用 `**粗体**` 标注。
  - 多点描述使用列表形式。
  - 技术术语需提供简明扼要的解释。

---

## 阶段 2：迭代执行与动态学习 (Execution & Dynamic Learning)

1.  **任务执行**: 严格按照任务清单执行，所有与记忆相关的操作（如指针解析、动态更新、复盘、持久化等）均遵循 [`memory.md`](memory.md) 中定义的规范。
2.  **状态维护**: 在每个子任务开始和结束时，**必须**使用 `update_todo_list` 更新任务状态。

---

## 阶段 3：任务收尾与交付 (Wrap-up & Delivery)

1.  **最终确认**: 在所有任务完成后，进行最终的复盘和确认。
2.  **成果交付**: 提交最终的交付物。
3.  **记忆清理**: 遵循 [`memory.md`](memory.md) 中的“受控清理”原则，在任务结束后清理工作记忆。