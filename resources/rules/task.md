---
name: task
title: 任务管理指南
description: "定义AI系统任务分解、评估与执行的核心规范，包含任务管理哲学、模式协作机制和工作流程"
category: rule
priority: critical
tags: [任务管理, 模式协作, 工作流程]
sections:
  - "核心理念：任务管理哲学和原则"
  - "任务层级：调度层与执行层"
  - "模式协作机制：专业分工与执行"
  - "工作流程：标准执行与最佳实践"
---

# 任务管理指南

> AI 系统任务分解、评估与执行的核心规范。

---

## 核心理念

**任务管理哲学**

- **简洁明了:** 所有描述、要求和交付物都应简洁清晰，避免冗余信息。
- **精准匹配:** 仅提供与任务直接相关的上下文，确保信息高度聚焦。
- **模式驱动:** 基于任务性质智能选择最适合的专业模式。
- **价值导向:** 每个任务都应明确其价值点和预期产出。

---

## 任务层级

### 两层架构

```
调度层 (orchestrator)
    ↓ 任务分解与委派
执行层 (各专业模式)
```

### 层级职责

| 层级       | 职责                         | 模式           |
| ---------- | ---------------------------- | -------------- |
| **调度层** | 任务分解、依赖管理、结果汇总 | `orchestrator` |
| **执行层** | 专业实现、原子操作、直接交付 | 各专业模式     |

### 任务流向

1. **复杂任务进入调度层**

   - `orchestrator` 接收并分析
   - 分解为可执行的子任务
   - 委派给对应的专业模式

2. **子任务进入执行层**
   - 各模式按专业领域执行
   - 完成后返回结果
   - 由 `orchestrator` 汇总

---

## 模式协作机制

### 模式选择指南

详细的模式职责和选择标准请参考 new_task.md#模式选择指南

### 协作流程

#### 标准协作流程

1. **任务接收** → `orchestrator`

   - 分析任务复杂度
   - 识别所需专业领域
   - 制定任务分解策略

2. **任务分解** → `orchestrator`

   - 创建子任务清单
   - 确定任务依赖关系
   - 分配执行模式

3. **专业执行** → 各专业模式

   - 按专业领域执行
   - 必要时进行模式间协作
   - 保持上下文传递

4. **结果汇总** → `orchestrator`
   - 收集各子任务结果
   - 验证整体完成度
   - 准备最终交付

#### 典型协作场景

**场景 1: 新功能开发**

```
orchestrator → architect → code → debug → doc-writer
     ↓           ↓        ↓       ↓          ↓
  任务分解 → 架构设计 → 代码实现 → 测试调试 → 文档编写
```

**场景 2: 系统重构**

```
orchestrator → project-research → architect → code → giter
     ↓                ↓              ↓        ↓        ↓
  任务分解 → 代码库分析 → 重构方案设计 → 重构实施 → 版本管理
```

---

## 工作流程

### 任务执行原则

1. **模式切换**: 禁止使用 `switch_mode`，所有模式转换通过 `new_task` 完成
2. **任务粒度**: 非 orchestrator 模式下，任务必须分解到原子级别
3. **决策确认**: L1 级决策必须通过 `ask_followup_question` 获得用户确认
4. **信息呈现**: 使用流程图、清单、表格等可视化方式展示方案
5. **模式专业化**: 严格遵循专业分工，超出能力范围的任务必须委派
6. **上下文精简**: 仅传递任务相关的上下文，避免信息过载

### 执行优化策略

#### 批量操作

- 单个 `apply_diff` 处理多个修改
- 合并多个 `read_file` 请求（最多 5 个）

#### 性能优化

- 合并相似操作，减少工具调用次数
- 缓存频繁访问的信息
- 使用脚本文件替代命令链

#### 质量保证

- 每个步骤执行前验证前置条件
- 关键节点更新任务状态
- 保持输出的一致性和专业性

### 上下文管理

#### 上下文传递原则

- 使用 `task_id_list` 追踪任务来源
- 在 `metadata.dependencies` 中声明依赖关系
- 保持信息精简但完整

#### 信息过滤

- 仅传递与当前任务直接相关的信息
- 避免复制整个历史上下文
- 使用引用而非嵌入大型内容

---

## 最佳实践总结

### 任务设计

- ✅ 任务描述清晰、具体、可衡量
- ✅ 明确定义验收标准
- ✅ 合理设置任务边界
- ✅ 考虑任务间的依赖关系

### 执行策略

- ✅ 优先处理关键路径任务
- ✅ 并行执行无依赖的任务
- ✅ 及时识别和处理阻塞
- ✅ 保持与用户的持续沟通

### 协作优化

- ✅ 明确各模式的职责边界
- ✅ 建立清晰的信息传递机制
- ✅ 定期同步任务进度
- ✅ 记录关键决策和变更
